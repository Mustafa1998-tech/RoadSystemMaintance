<!DOCTYPE html>
{% load static i18n %}
<html lang="en" class="h-full" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true', isMobileMenuOpen: false, isUserMenuOpen: false, isNotificationsOpen: false }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Road Maintenance System{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        success: {
                            50: '#f0fdf4',
                            500: '#10b981',
                            700: '#047857',
                        },
                        warning: {
                            50: '#fffbeb',
                            500: '#f59e0b',
                            700: '#b45309',
                        },
                        danger: {
                            50: '#fef2f2',
                            500: '#ef4444',
                            700: '#b91c1c',
                        },
                        info: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            700: '#1d4ed8',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out',
                        'slide-up': 'slide-up 0.3s ease-out',
                    },
                },
            },
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/ws.js"></script>
    
    <!-- Lottie Animations -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <!-- Anime.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200"
      :class="{ 'dark': darkMode }"
      x-init="
        // Initialize dark mode from localStorage or system preference
        if (localStorage.getItem('darkMode') === null) {
            darkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            localStorage.setItem('darkMode', darkMode);
        }
        
        // Apply dark mode class to html element
        $el.classList.toggle('dark', darkMode);
        
        // Initialize tooltips
        document.addEventListener('alpine:init', () => {
            Alpine.directive('tooltip', (el, { expression }, { evaluateLater, effect }) => {
                const getTooltipContent = evaluateLater(expression);
                let tooltip = null;
                
                const showTooltip = (event) => {
                    if (tooltip) return;
                    
                    getTooltipContent(content => {
                        tooltip = document.createElement('div');
                        tooltip.className = 'absolute z-50 px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm dark:bg-gray-700 whitespace-nowrap';
                        tooltip.textContent = content;
                        document.body.appendChild(tooltip);
                        
                        const rect = el.getBoundingClientRect();
                        const tooltipRect = tooltip.getBoundingClientRect();
                        
                        tooltip.style.top = `${rect.bottom + window.scrollY + 5}px`;
                        tooltip.style.left = `${rect.left + (rect.width - tooltipRect.width) / 2}px`;
                        
                        tooltip.classList.add('animate-fade-in');
                    });
                };
                
                const hideTooltip = () => {
                    if (!tooltip) return;
                    tooltip.remove();
                    tooltip = null;
                };
                
                el.addEventListener('mouseenter', showTooltip);
                el.addEventListener('mouseleave', hideTooltip);
                el.addEventListener('focus', showTooltip);
                el.addEventListener('blur', hideTooltip);
                
                return () => {
                    el.removeEventListener('mouseenter', showTooltip);
                    el.removeEventListener('mouseleave', hideTooltip);
                    el.removeEventListener('focus', showTooltip);
                    el.removeEventListener('blur', hideTooltip);
                    if (tooltip) tooltip.remove();
                };
            });
        });
      ">
    
    <!-- Mobile menu overlay -->
    <div x-show="isMobileMenuOpen" 
         @click="isMobileMenuOpen = false"
         class="fixed inset-0 z-20 bg-black bg-opacity-50 lg:hidden"
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         x-cloak>
    </div>
    
    <!-- Navigation -->
    {% include 'includes/navbar.html' %}
    
    <!-- Main Content -->
    <main class="min-h-[calc(100vh-4rem)] pt-16">
        {% if messages %}
        <div class="container mx-auto px-4 py-2">
            {% for message in messages %}
            <div class="mb-4 px-4 py-3 rounded-md {% if message.tags %}{{ message.tags }}{% endif %}"
                 x-data="{ show: true }"
                 x-show="show"
                 x-init="setTimeout(() => show = false, 5000)"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-2"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-y-0"
                 x-transition:leave-end="opacity-0 transform translate-y-2">
                <div class="flex items-center">
                    {% if message.tags == 'bg-green-100 border border-green-400 text-green-700' %}
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    {% elif message.tags == 'bg-red-100 border border-red-400 text-red-700' %}
                    <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                    {% elif message.tags == 'bg-yellow-100 border border-yellow-400 text-yellow-700' %}
                    <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                    {% else %}
                    <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                    {% endif %}
                    <span class="flex-1">{{ message }}</span>
                    <button @click="show = false" class="ml-4 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'includes/footer.html' %}
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" 
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden"
         x-data="{ show: false }"
         @htmx:before-request="show = true"
         @htmx:after-request="show = false"
         x-show="show"
         x-transition:enter="transition-opacity ease-linear duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl">
            <div class="flex items-center space-x-4">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"></div>
                <div class="text-lg font-medium text-gray-900 dark:text-white">Loading...</div>
            </div>
        </div>
    </div>
    
    <!-- Custom JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>
    {% block extra_js %}{% endblock %}
    
    <script>
        // Initialize animations on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Animate elements with data-animate attribute
            document.querySelectorAll('[data-animate]').forEach((el, index) => {
                const animation = el.getAttribute('data-animate');
                const delay = el.getAttribute('data-delay') || index * 100;
                
                setTimeout(() => {
                    el.classList.add(animation);
                }, delay);
            });
            
            // Initialize counters
            document.querySelectorAll('[data-counter]').forEach(el => {
                const target = parseInt(el.getAttribute('data-counter'));
                const duration = el.getAttribute('data-duration') || 2000;
                const start = parseInt(el.getAttribute('data-start') || '0');
                const suffix = el.getAttribute('data-suffix') || '';
                const prefix = el.getAttribute('data-prefix') || '';
                
                anime({
                    targets: el,
                    innerHTML: [start, target],
                    round: 1,
                    easing: 'easeOutCubic',
                    duration: duration,
                    update: function(anim) {
                        el.innerHTML = prefix + Math.round(anim.animations[0].currentValue) + suffix;
                    }
                });
            });
        });
    </script>
</body>
</html>
